(this.webpackJsonpjarvis=this.webpackJsonpjarvis||[]).push([[27,39],{1353:function(e,t,a){"use strict";a.r(t);var n=a(55),i=a(9),r=a(0),l=a.n(r),c=a(6),d=a(12),o=a(50),s=a(243),u=a(70),m=a(110),f=a(244),v=a(32),g=a(162),p=a(348),b=a(27),y=l.a.memo((function(e){d.default._("WidgetPage","RENDER ComponentConfig","development");var t=e._onClose,a=e._onChange,y=e.id,E=e.config,O=e.attributes,h=Object(r.useState)(!1),C=Object(i.a)(h,2),j=C[0],S=C[1];if(Object(r.useEffect)((function(){S(null!==E)}),[E]),null===y||null===E||void 0===E)return null;var x=Object.keys(E).map((function(t){var i=E[t],r=i="object"===typeof i?i:{label:t,val:void 0!==i.val?i.val:i},d=r._translate,s=r.info,g=Object(n.a)(r,["_translate","info"]);g.label=i.label||t,g.label=d?c.default.t(i.label):i.label,g.val=d?c.default.t(i.val):i.val,g.selection="function"===typeof g.selection?g.selection(e):g.selection;var h=b.default[i.type||"Text"];return l.a.createElement(u.a,{key:"Config-"+t,divider:!0},l.a.createElement(m.a,{disableTypography:!0},l.a.createElement(o.a,{container:!0,spacing:1},l.a.createElement(o.a,{item:!0},l.a.createElement(p.default,{info:s})),l.a.createElement(o.a,{item:!0},l.a.createElement(v.a,null,c.default.t(g.label))))),l.a.createElement(f.a,null,l.a.createElement(h,Object.assign({key:"componentConfig."+y+"."+t,id:"componentConfig."+y+"."+t},g,{label:"",width:180,inputProps:{style:{textAlign:"right"}},onChange:function(e,t){return a(e,t,O)}}))))}));return l.a.createElement(g.default,{header:c.default.t("Component configuration"),actions:l.a.createElement(b.default.Button,{key:"action-save",variant:"text",onClick:function(){S(!1),t()},color:"primary",label:"Apply"}),dense:!0,maxWidth:"xs",fullWidth:!0,open:j},l.a.createElement(s.a,{dense:!0,disablePadding:!0},x))}));t.default=y},1376:function(e,t,a){"use strict";a.r(t);var n=a(24),i=a(21),r=a(5),l=a(9),c=a(0),d=a.n(c),o=a(2),s=a(1454),u=a(102),m=a(30),f=a(518),v=a(349),g=a(18),p=a(6),b=a(12),y=a(128),E=a(34),O=a(1026),h=a(125),C=a(50),j=a(57),S=a(243),x=a(70),k=a(32),_=a(249),D=a.n(_),I=a(1460),M=a.n(I),P=a(1462),A=a.n(P),F=a(1461),w=a.n(F),K=a(1353),R=a(162),N=a(26),B=a(27),W=a(519),z=a(41),H=Object(z.a)((function(e){return{iconContainer:{display:"flex",alignItems:"center"},iconCentered:{verticalAlign:"middle",marginRight:e.spacing(2)},noPadding:{padding:0},alignRight:{display:"flex",justifyContent:"flex-end","& > :not(:first-child)":{marginLeft:8}},height:{lineHeight:"45px"},title:{lineHeight:"25px"},Badge:{right:"unset",transform:"none"},sticky:{position:"sticky",backgroundColor:e.palette.background.default,top:-16,zIndex:1}}})),L=a(1033),q=a(63)();t.default=function(e){var t=H(),a=Object(c.useState)({}),n=Object(l.a)(a,2),o=n[0],s=n[1],u=Object(c.useRef)(q(Object(r.a)({moduleConfig:{},devices:[]},e.widget)));Object(c.useEffect)((function(){Object(v.decryptAllPasswords)(u.current).then((function(e){return u.current=e}))}),[]);var m=function(){u.current=null,e.onClose()},f=Object(c.useCallback)((function(t){var a={};if([].concat([{parameter:"title",required:!0},{parameter:"module",required:!0}],Object(i.a)(y.ModuleConfigurations[u.current.module]||[])).forEach((function(e){!0!==e.required||u.current[e.parameter]||u.current.moduleConfig[e.parameter]||(a[e.parameter]=!0)})),Object.values(a).indexOf(!0)>-1)return s((function(e){return Object(r.a)(Object(r.a)({},e),a)})),!1;Object(v.encryptAllPasswords)(u.current).then(e.onSave)}),[e.onSave]),g=Object(c.useCallback)((function(e,t,a){if(s((function(t){var a=Object(r.a)({},t);return e.error&&e.error!==t[e.id]?a[e.id]=e.error:!e.error&&t[e.id]&&delete a[e.id],a})),void 0!==a)if(u.current.devices=u.current.devices||[],u.current.devices[a]=u.current.devices[a]||{},e.id.indexOf("componentConfig.")>-1){var n=e.id.split("."),i=Object(l.a)(n,3),c=i[1],d=i[2];u.current.devices[a][c]=u.current.devices[a][c]||{},u.current.devices[a][c][d]=t}else u.current.devices[a][e.id]=t;else e.id.indexOf("moduleConfig.")>-1?u.current.moduleConfig[e.id.replace("moduleConfig.","")]=t:u.current[e.id]=t}),[]),b=Object(c.useCallback)((function(e,t){g({error:!t,id:e},t||"")}),[g]);return Object(c.useEffect)((function(){return b("title",e.widget.title)}),[]),null===e.widget?null:d.a.createElement(R.default,{header:p.default.t("Widget configuration"),actions:d.a.createElement(C.a,{container:!0},d.a.createElement(C.a,{item:!0,xs:6},void 0!==e.widget.index&&d.a.createElement(B.default.Button,{key:"action-delete",variant:"text",onClick:function(){return e.onDelete(e.widget.index)},color:"secondary",startIcon:d.a.createElement(D.a,null),label:"Delete Widget"}),"\xa0"),d.a.createElement(C.a,{item:!0,xs:6,className:t.alignRight},d.a.createElement(B.default.Button,{key:"action-cancel",variant:"text",onClick:m,color:"secondary",label:"Cancel"}),d.a.createElement(B.default.Button,{key:"action-save",variant:"text",onClick:f,color:"primary",disabled:Object.keys(o).length>0,label:"Apply"}))),dense:!0,maxWidth:!1,fullWidth:!0,open:!0,onClose:m},d.a.createElement(T,Object.assign({},e,{_onChange:g,_validate:b,editor:u.current})),d.a.createElement(G,Object.assign({},e,{_onChange:g,editor:u.current})))};var T=d.a.memo((function(e){b.default._("WidgetPage","RENDER SectionWidget","development");var t=e._onChange,a=e.editor,n=Object.values(f.default).map((function(e){var n=B.default[e.type||"Text"];return delete e.hideOn,d.a.createElement(B.default.FieldsetItem,{key:"key-"+e.parameter,columns:e.columns||2},d.a.createElement(n,Object.assign({},e,{id:e.parameter,onChange:t,val:void 0!==a[e.parameter]?a[e.parameter]:e.val||""})))}));return d.a.createElement(B.default.Fieldset,{label:"Widget-Box"},n)})),G=d.a.memo((function(e){b.default._("WidgetPage","RENDER SectionModule","development");var t=e._onChange,a=e.editor,n=Object(c.useState)(a.module||m.default.get("DEFAULT_MODULE")),i=Object(l.a)(n,2),r=i[0],o=i[1];return d.a.createElement(B.default.Fieldset,{label:"Module"},d.a.createElement(B.default.FieldsetItem,null,d.a.createElement(B.default.Text,{key:"module",id:"module",required:!0,label:"config#Layout#widgetModule#label",autoComplete:!0,autoHighlight:!0,val:r,options:y.ModuleList,onChange:function(e,a){t(e,a),o(a)}})),d.a.createElement(U,Object.assign({},e,{moduleSettings:r&&y.ModuleSettings[r]||{},moduleConfigurations:r&&y.ModuleConfigurations[r]||[]})),d.a.createElement(J,Object.assign({},e,{moduleSettings:r&&y.ModuleSettings[r]||{}})))})),U=function(e){b.default._("WidgetPage","RENDER ModuleConfig","development");var t=e._onChange,a=e.moduleSettings,i=e.moduleConfigurations,o=e.editor,s=Object(c.useState)({}),u=Object(l.a)(s,2),m=u[0],f=u[1];Object(c.useEffect)((function(){var e=Object.keys(m);e.length>0&&e.forEach((function(e){return t({error:!0,id:e},"")}))}),[m,t]);var v=[];return i.length>0&&v.push(i.map((function(e){if(e.hide)return null;"function"===typeof e.selection&&(e.selection=e.selection()),m["moduleConfig."+e.parameter]||!0!==e.required||o.moduleConfig[e.parameter]||e.val||f((function(t){return Object(r.a)(Object(r.a)({},t),{},Object(n.a)({},"moduleConfig."+e.parameter,!0))}));var a=B.default[e.type||"Text"];return d.a.createElement(B.default.FieldsetItem,{columns:e.columns||3,key:"ModuleConfiguration-"+e.parameter},d.a.createElement(a,Object.assign({},e,{key:"moduleConfig-"+e.parameter,id:"moduleConfig."+e.parameter,label:e.label||e.parameter,info:e.description,onChange:t,val:void 0!==o.moduleConfig[e.parameter]?o.moduleConfig[e.parameter]:e.val})))}))),void 0!==a.ModuleConfiguration&&v.push(d.a.createElement(C.a,{key:"CustomModuleConfiguration",item:!0,xs:12},d.a.createElement(h.a,{style:{marginBottom:8}}),d.a.createElement(a.ModuleConfiguration,{options:o.moduleConfig,_onChange:t}))),0===v.length&&(v=d.a.createElement(B.default.FieldsetItem,{key:"noModuleConfiguration",noPadding:!0},d.a.createElement(k.a,null,p.default.t("No configuration available for this module"),"."))),[d.a.createElement(B.default.FieldsetItem,{key:"ModuleConfiguration",noPadding:!0},d.a.createElement(B.default.FieldsetLegend,{label:"Module Configuration",variant:"h4",divider:!1})),v]},J=d.a.memo((function(e){b.default._("WidgetPage","RENDER SectionDevices","development");var t=H(),a=e._onChange,n=e.moduleSettings,o=e.editor,u=Object(c.useState)(o.devices||[]),m=Object(l.a)(u,2),f=m[0],v=m[1],y=Object(c.useState)(""),E=Object(l.a)(y,2),h=E[0],C=E[1];if(!n.devices)return null;var j=function(e,t){var n={type:e};"device"===e?n.deviceId=t.id:"group"===e&&(n.name=t);var r=[].concat(Object(i.a)(f),[n]);C(""),v(r),a({id:"devices"},r)},x=function(e,t,n){return a(t,n,e)},k=function(e){var t=Object(i.a)(f);t.splice(e,1),v(t),a({id:"devices"},t)},_=Object(g.sortArray)(Object(g.sortArray)(Object.values(e.devices),"name"),"function"),D=f.map((function(e){return e.deviceId})),I=!1,M=f.map((function(t,a){var n=Object.keys(t.states||{}),i=void 0!==t.bodyStateKey?t.bodyStateKey:t.primaryStateKey||n&&n[0]||null;return"group"===t.type?I=!0:"divider"===t.type&&(I=!1),d.a.createElement(V,Object.assign({},e,{key:t.type+"- "+(t.deviceId||t.name)+"-"+a,_addItem:j,_editItem:x,_deleteItem:k,device:e.devices[t.deviceId]||null,options:Object(r.a)(Object(r.a)({label:i&&t.states&&t.states[i]&&t.states[i].label||""},t),{},{index:a}),withinGroup:I,devices:f}))}));return d.a.createElement(d.a.Fragment,null,d.a.createElement(B.default.FieldsetItem,{noPadding:!0},d.a.createElement(B.default.FieldsetLegend,{label:"Assigned Devices",variant:"h4",divider:!1})),d.a.createElement(B.default.Fieldset,{noPadding:!0},d.a.createElement(B.default.Fieldset,{noPadding:!0,className:t.sticky},d.a.createElement(B.default.FieldsetItem,{columns:3},d.a.createElement(B.default.Text,{width:"90%",key:"addDevice",id:"addDevice",label:"Add device",error:""!==h,errorMessage:h,autoComplete:!0,autoHighlight:!0,disableCloseOnSelect:!0,clearOnSelect:!0,clearOnBlur:!0,options:_,getOptionLabel:function(e){return p.default.t(e.function)+" "+e.name+(e.attributes&&e.attributes.manufacturer?" ("+e.attributes.manufacturer.name+")":"")},renderOption:function(e,a){var n=D.indexOf(e.id)>-1?D.filter((function(t){return t===e.id})).length:0;return d.a.createElement(O.a,{badgeContent:n,classes:{badge:t.Badge},color:"primary"},d.a.createElement("span",{style:{fontSize:"0.8rem",paddingLeft:"24px"}},n>0?d.a.createElement("strong",null,e.name):e.name))},onChange:function(e,t){if(t){var a=Object.keys(t.states||{});n.devicesStates&&n.devicesStates.requiredStates&&Array.isArray(n.devicesStates.requiredStates)&&n.devicesStates.requiredStates.some((function(e){return-1===a.indexOf(e)}))?C(p.default.t("Device needs one of the following states")+": "+n.devicesStates.requiredStates.join(", ")):j("device",t)}},groupBy:function(e){return p.default.t(e.function)},closeIcon:null,popupIcon:null})),Array.isArray(n.devices)&&n.devices.indexOf("group")>-1&&[d.a.createElement(B.default.FieldsetItem,{key:"orGroup",columns:1,centered:!0},d.a.createElement("em",null,p.default.t("or"))),d.a.createElement(B.default.FieldsetItem,{key:"addGroup",columns:3},d.a.createElement(B.default.Text,{width:"90%",key:"addGroup",id:"addGroup",label:"Add group",onEnter:function(e,t){return t&&j("group",t)},clearOnEnter:!0,clearOnBlur:!0}))],Array.isArray(n.devices)&&n.devices.indexOf("divider")>-1&&[d.a.createElement(B.default.FieldsetItem,{key:"orDivider",columns:1,centered:!0},d.a.createElement("em",null,p.default.t("or"))),d.a.createElement(B.default.FieldsetItem,{key:"addDivider",columns:3},d.a.createElement(B.default.Button,{key:"addDivider",id:"addDivider",label:"Add divider",onClick:function(){return j("divider")}}))]),d.a.createElement(B.default.FieldsetItem,null,d.a.createElement(s.a,{onDragEnd:function(e){if(e.source&&e.destination&&e.source.index!==e.destination.index){var t=Object(i.a)(f);t.splice(e.destination.index,0,t.splice(e.source.index,1)[0]),v(t),a({id:"devices"},t)}}},d.a.createElement(s.c,{key:"dropList",droppableId:"dropList"},(function(e,a){return d.a.createElement("div",Object.assign({ref:e.innerRef,style:{minHeight:50}},e.droppableProps),d.a.createElement(S.a,{classes:{root:t.fullWidth},dense:!0,disablePadding:!0},M,e.placeholder))}))))))})),V=d.a.memo((function(e){b.default._("WidgetPage","RENDER Device","development");var t=H(),a=e._editItem,m=e._deleteItem,f=e.devices,v=e.device,g=e.options,y=e.moduleSettings,O=Object(c.useState)(null),h=Object(l.a)(O,2),S=h[0],k=h[1],_=v&&v.states&&Object.keys(v.states||{}).map((function(e){return Object(n.a)({_key:e,_translated:!0},e,v.states[e].label||e)})),I=g.deviceId,P=d.a.createElement(M.a,{classes:{root:t.iconCentered}}),F=null;"device"===g.type&&null!==v?(I=d.a.createElement("span",{className:t.title},v.name+" ("+p.default.t(v.function)+", #"+v.id+")"),y.DeviceActionsConfiguration||(F=(!y.devicesStates||y.devicesStates&&!1!==y.devicesStates.selectable)&&d.a.createElement(C.a,{container:!0,spacing:1},d.a.createElement(C.a,{item:!0,xs:6},(!y.devicesStates||!y.devicesStates.selectable||y.devicesStates.selectable&&y.devicesStates.selectable.indexOf("primaryStateKey")>-1)&&d.a.createElement(B.default.Select,{id:"primaryStateKey",width:150,label:"Primary State Key",selection:_,val:void 0!==g.primaryStateKey?g.primaryStateKey:v.primaryStateKey,onChange:function(e,t){t="object"===typeof t?t[t._key]:t,a(g.index,e,t)},disabled:y.devicesStates&&y.devicesStates.disabled&&y.devicesStates.disabled.indexOf("primaryStateKey")>-1})),d.a.createElement(C.a,{item:!0,xs:6},!y.devicesStates||!y.devicesStates.selectable||y.devicesStates.selectable&&y.devicesStates.selectable.indexOf("secondaryStateKey")>-1?d.a.createElement(B.default.Select,{id:"secondaryStateKey",width:150,label:"Secondary State Key",selection:[{"":p.default.t("none")}].concat(Object(i.a)(_)),val:void 0!==g.secondaryStateKey?g.secondaryStateKey:v.secondaryStateKey,onChange:function(e,t){t="object"===typeof t?t[t._key]:t,a(g.index,e,t)},disabled:y.devicesStates&&y.devicesStates.disabled&&y.devicesStates.disabled.indexOf("secondaryStateKey")>-1}):d.a.createElement(W.default,{width:150})),y.devicesStates&&!0===y.devicesStates.lastUpdateOption&&d.a.createElement(C.a,{item:!0,xs:12},d.a.createElement(B.default.Switch,{id:"lastUpdate",label:"Display Last Update",val:void 0===g.lastUpdate||g.lastUpdate,onChange:function(e,t){return a(g.index,e,t)}}))))):"group"===g.type?(P=d.a.createElement(w.a,{classes:{root:t.iconCentered}}),I=d.a.createElement("span",{className:t.title},g.name)):"divider"===g.type&&(P=d.a.createElement(A.a,{classes:{root:t.iconCentered}}),I=d.a.createElement("em",{className:t.title},"("+p.default.t("divider")+")"));var R={device:v||{},deviceStates:_,options:Object(r.a)(Object(r.a)({},f[g.index]||g),{},{withinGroup:e.withinGroup}),elements:{DeviceIcon:P,Device:I,Actions:F},onChange:function(e,t){return a(g.index,e,t)},onConfig:function(e,t,a){var n=L(E.componentsOptions._defaults[a]||{},E.componentsOptions[v.function]&&E.componentsOptions[v.function][a]||{}),i=L(v&&v.states&&v.states[t]&&v.states[t][a+"Config"]||{},g[a+"Config"]||{});Object.keys(i).forEach((function(e){var a=e.indexOf("-")>-1?e.split("-"):["",e],r=Object(l.a)(a,2)[1];n[r]="object"!==typeof n[r]?{val:n[r]}:n[r],n[r].val=i[t+"-"+r]||i[r]||n[r].val})),k({id:e,device:v,config:n,attributes:{stateKey:t,element:a}})}};return d.a.createElement(s.b,{key:"uuid-"+Object(u.a)(JSON.stringify(v)+"_"+JSON.stringify(R.options),"4eaf6392-6a70-4802-b343-5ff1a1673f39"),draggableId:"device-"+g.deviceId+"-"+g.index,index:g.index},(function(e,n){return d.a.createElement("div",Object.assign({className:Object(o.a)(t.drag,n.isDragging&&t.isDragging),ref:e.innerRef},e.draggableProps,e.dragHandleProps),d.a.createElement(K.default,Object.assign({_onClose:function(){return k(null)},_onChange:function(e,t,n){var i=n.stateKey+"-"+e.id.substr(e.id.lastIndexOf(".")+1),l=n.element+"Config";g[l]=g[l]||{},g[l][i]=t,a(g.index,Object(r.a)(Object(r.a)({},e),{},{id:"componentConfig."+l+"."+i}),t)}},S||{})),d.a.createElement(x.a,{divider:!0,classes:{container:t.height}},d.a.createElement(C.a,{container:!0,item:!0,xs:1},d.a.createElement("div",{className:t.iconContainer},d.a.createElement(N.default,{style:{fontSize:"1.5em"},icon:"mdi:drag"})),d.a.createElement(j.a,{onClick:function(){return m(g.index)}},d.a.createElement(D.a,null))),d.a.createElement(C.a,{container:!0,item:!0,xs:5},y.DeviceBodyConfiguration?d.a.createElement(y.DeviceBodyConfiguration,R):d.a.createElement(d.a.Fragment,null,P," ",I)),d.a.createElement(C.a,{container:!0,item:!0,xs:6},y.DeviceActionsConfiguration?d.a.createElement(y.DeviceActionsConfiguration,R):F)))}))}))},1460:function(e,t,a){"use strict";var n=a(38),i=a(39);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(a(0)),l=(0,n(a(40)).default)(r.createElement("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"}),"Devices");t.default=l},1461:function(e,t,a){"use strict";var n=a(38),i=a(39);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(a(0)),l=(0,n(a(40)).default)(r.createElement("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"}),"FormatListBulleted");t.default=l},1462:function(e,t,a){"use strict";var n=a(38),i=a(39);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(a(0)),l=(0,n(a(40)).default)(r.createElement("path",{d:"M19 13H5v-2h14v2z"}),"Remove");t.default=l}}]);
//# sourceMappingURL=27.a22fcfa6.chunk.js.map